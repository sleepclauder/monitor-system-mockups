# Задача: Разработка страницы "Объекты мониторинга" (objects.html)

## Описание задачи

Необходимо реализовать страницу для управления объектами мониторинга (HLS / MPEG-TS потоками) с поддержкой фильтрации, массовых операций и контекстного управления.

## Бизнес-требования

Страница предназначена для:
- Просмотра и управления большим количеством объектов мониторинга (100+ записей)
- Фильтрации по имени, URL, группам доступа и тегам
- Выполнения массовых операций (изменение групп, тегов, удаление)
- Быстрого доступа к операциям через контекстное меню

## Макет

**Файл:** `pages/objects.html`
**Связанная документация:** `docs/103_objects-page.md`, `docs/101_object-set.md`

---

## 1. Компоненты страницы

### 1.1 Header (Шапка страницы)

**Расположение:** Верхняя часть страницы

| Элемент | Спецификация |
|---------|--------------|
| Заголовок | "Объекты мониторинга" (h2, font-size: 32px, font-weight: 700) |
| Подзаголовок | "Управление потоками HLS / MPEG-TS" (font-size: 15px, color: text-secondary) |
| Кнопка "Экспорт списка" | Стиль: btn-secondary, выравнивание: справа |
| Кнопка "+ Добавить объект" | Стиль: btn-primary, выравнивание: справа |

**Действия:**
- "Экспорт списка" → экспорт текущего списка объектов (с учётом фильтров) в CSV/JSON
- "+ Добавить объект" → открытие формы создания нового объекта мониторинга

---

### 1.2 Панель фильтров (.filters-section)

**Макет:** Grid с 4 колонками (`grid-template-columns: 2fr 1fr 1fr 1fr`)

#### Поле "Поиск"
- **Тип:** Text input
- **Placeholder:** "Имя объекта или URL..."
- **Функция:** Поиск по названию объекта или URL в реальном времени (debounce 300ms)

#### Фильтр "Группа"
- **Тип:** Кастомный dropdown с множественным выбором (чекбоксы)
- **По умолчанию:** "Все группы"
- **Значения:** Administrators, Operators, Engineers, Guests
- **Поведение:** При выборе ≥1 группы текст кнопки меняется на перечисление через запятую, например: "Administrators, Operators"

#### Фильтр "Тег"
- **Тип:** Кастомный dropdown с множественным выбором (чекбоксы)
- **По умолчанию:** "Все теги"
- **Значения:** HLS, MPEG-TS, Live, VOD
- **Поведение:** Аналогично фильтру "Группа"

#### Кнопки действий
- **"Сбросить"** (btn-secondary) → сброс всех фильтров
- **"Применить"** (btn-primary) → применение фильтров к таблице

**UX-требования для dropdown-фильтров:**
1. Клик по кнопке фильтра открывает/закрывает выпадающий список
2. Одновременно может быть открыт только один dropdown (взаимное закрытие)
3. Клик по чекбоксу внутри dropdown **НЕ закрывает** его (stopPropagation)
4. Клик вне dropdown закрывает его
5. Текст кнопки обновляется динамически при изменении выбора

---

### 1.3 Панель массовых операций (.bulk-toolbar)

**Видимость:** Скрыта по умолчанию, появляется при выборе ≥1 строки с анимацией slideDown (0.2s)

**Состав:**

| Элемент | Описание |
|---------|----------|
| Счётчик | "Выбрано: N" (font-size: 14px, font-weight: 600, color: accent-primary) |
| Разделитель | Вертикальная линия (1px × 24px, border-color) |
| Кнопка "Изменить группу" | Dropdown с множественным выбором + кнопки "Отмена"/"OK" |
| Кнопка "Изменить теги" | Dropdown с множественным выбором + кнопки "Отмена"/"OK" |
| Кнопка "Удалить" | btn-danger, открывает модальное окно подтверждения |

**Стиль:** Рамка с цветом accent-primary (зелёная), выделяющая панель

**Dropdown в bulk-toolbar:**
- **"Изменить группу":** Administrators, Operators, Engineers, Guests (множественный выбор)
- **"Изменить теги":** HLS, MPEG-TS, Live, VOD (множественный выбор)

**UX-требования:**
1. Открытие одного dropdown автоматически закрывает другой
2. Клик внутри dropdown (по чекбоксам) НЕ закрывает его
3. Кнопка "Отмена" → закрывает dropdown без применения изменений
4. Кнопка "OK" → применяет изменения и закрывает dropdown
5. Изменения применяются ко всем выбранным объектам

---

### 1.4 Таблица объектов (.objects-table)

#### Структура столбцов

| # | Столбец | Ширина | CSS-класс | Описание |
|---|---------|--------|-----------|----------|
| 1 | ☐ | 48px | `.th-checkbox` / `.td-checkbox` | Чекбокс выбора (center align) |
| 2 | Название объекта | auto | `.object-name-cell` | Имя потока (font-weight: 600) |
| 3 | URL | auto | `.object-url-cell` | URL потока (моноширинный шрифт) |
| 4 | Группа доступа | auto | `.group-badge` | Бейджи групп (может быть несколько) |
| 5 | Теги | auto | `.tag` | Теги с цветовой кодировкой |

#### Спецификация столбца "URL"
- **Шрифт:** JetBrains Mono, 12px
- **Цвет:** accent-secondary (#00ccff)
- **Max-width:** 320px
- **Overflow:** ellipsis (обрезка с троеточием)

#### Спецификация столбца "Группа доступа"
- **Формат:** Бейджи с цветным фоном и рамкой
- **Стиль:** `background: rgba(0, 204, 255, 0.1); border: 1px solid rgba(0, 204, 255, 0.2)`
- **Возможные значения:** Administrators, Operators, Engineers, Guests
- **Множественность:** У одного объекта может быть несколько групп

#### Спецификация столбца "Теги"

**Цветовая кодировка тегов:**

| Тег | CSS-класс | Background | Text color |
|-----|-----------|------------|------------|
| HLS | `.tag--hls` | rgba(255, 170, 0, 0.1) | #ffaa00 (warning) |
| MPEG-TS | `.tag--mpegts` | rgba(0, 204, 255, 0.1) | #00ccff (secondary) |
| Live | `.tag--live` | rgba(0, 255, 136, 0.1) | #00ff88 (primary) |
| VOD | `.tag` (базовый) | bg-tertiary | text-secondary |

#### Интерактивность таблицы

**1. Выбор строк (чекбоксы):**
- Чекбокс в заголовке (Select All): выделяет/снимает все строки
- Индивидуальный чекбокс: выделяет одну строку
- Состояние Select All обновляется автоматически:
  - `checked` — если все строки выбраны
  - `indeterminate` — если выбраны некоторые строки
  - `unchecked` — если ничего не выбрано

**2. Визуальная обратная связь:**
- Выбранные строки получают класс `.selected` с фоном `rgba(0, 255, 136, 0.04)`
- Hover эффект: `background: rgba(255, 255, 255, 0.02)`
- Анимация появления строк: fadeIn с задержкой 0.03s на каждую строку

**3. Контекстное меню (правый клик):**
- Появляется при ПКМ на строке таблицы
- Позиционируется по координатам курсора
- Автоматически выделяет строку, если она не была выбрана
- Пункты меню:
  - "Изменить группу" → открывает bulk-dropdown групп
  - "Изменить теги" → открывает bulk-dropdown тегов
  - ── разделитель ──
  - "Удалить" (красный текст) → открывает модальное окно удаления

---

### 1.5 Пагинация (.table-footer)

**Расположение:** Подвал таблицы

**Левая часть:**
- Текст: "Показано 1-8 из 142 объектов" (font-size: 13px, color: text-secondary)
- Динамически обновляется при навигации

**Правая часть:**
- Кнопки навигации: ← 1 2 3 ... 18 →
- Активная страница: фон accent-primary, текст тёмный
- Неактивные страницы: фон bg-tertiary, рамка border-color
- Hover: рамка accent-primary

---

### 1.6 Модальное окно подтверждения удаления

**Триггер:** Кнопка "Удалить" в bulk-toolbar или контекстном меню

**Структура:**

| Элемент | Спецификация |
|---------|--------------|
| Overlay | Полупрозрачный чёрный фон (rgba(0,0,0,0.6)), z-index: 1000 |
| Иконка | "!" на красноватом фоне (56×56px, border-radius: 12px) |
| Заголовок | "Удалить объекты?" (font-size: 20px, font-weight: 700) |
| Текст | "Вы уверены, что хотите удалить выбранные объекты (N шт.)? Это действие нельзя отменить." — N подставляется динамически |
| Кнопка "Отмена" | btn-secondary → закрывает модалку без действий |
| Кнопка "Удалить" | btn-danger → удаляет выбранные объекты, закрывает модалку |

**Анимация:** Scale от 0.95 до 1 за 0.2s

**Закрытие модалки:**
- Кнопка "Отмена"
- Клик по overlay (вне модального окна)

---

## 2. Тестовые данные (Mock)

**Количество объектов в таблице:** 8 строк для демонстрации

| Название | URL | Группы | Теги |
|----------|-----|--------|------|
| TV Channel 1 - Main Feed | https://stream.example.com/ch1/index.m3u8 | Administrators, Operators | HLS, Live |
| TV Channel 2 - Sports | https://stream.example.com/ch2/index.m3u8 | Operators | HLS, Live |
| Radio Stream - FM 101.5 | udp://239.0.0.10:1234 | Operators, Engineers | MPEG-TS, Live |
| Test Stream - QA | https://staging.example.com/test/index.m3u8 | Engineers, Guests | HLS, Live, VOD |
| Backup Feed - Channel 1 | udp://239.0.0.20:5500 | Administrators | MPEG-TS |
| Dev Environment Stream | https://dev.example.com/stream/index.m3u8 | Engineers | HLS, VOD |
| TV Channel 3 - News 24/7 | https://stream.example.com/ch3/index.m3u8 | Administrators, Guests | HLS, Live |
| IPTV Multicast - Region A | udp://239.1.1.1:8000 | Operators | MPEG-TS, Live |

**Пагинация mock:** "Показано 1-8 из 142 объектов"

---

## 3. Дизайн-система и стилевые параметры

### 3.1 CSS-переменные (Dark Theme)

```css
--bg-primary: #0a0e1a;        /* Фон body */
--bg-secondary: #111827;      /* Фон карточек/таблицы */
--bg-tertiary: #1a2332;       /* Фон полей ввода/thead */
--accent-primary: #00ff88;    /* Зелёный (основной акцент) */
--accent-secondary: #00ccff;  /* Голубой (ссылки, URL) */
--accent-warning: #ffaa00;    /* Оранжевый (теги HLS) */
--accent-danger: #ff3366;     /* Красный (удаление) */
--text-primary: #e4e8f0;      /* Основной текст */
--text-secondary: #8b94a8;    /* Вторичный текст */
--border-color: #1f2937;      /* Границы элементов */
--glow: rgba(0, 255, 136, 0.2); /* Эффект свечения */
```

### 3.2 Типографика

| Шрифт | Веса | Использование |
|-------|------|---------------|
| Outfit | 300, 400, 600, 700 | Основной UI, заголовки, кнопки |
| JetBrains Mono | 400, 500, 700 | URL-ячейки, моноширинный текст |

**Google Fonts:**
```
https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Outfit:wght@300;400;600;700&display=swap
```

### 3.3 Z-index карта

| Z-index | Элемент |
|---------|---------|
| 0 | body::before (градиентный фон) |
| 1 | .container (основной контейнер) |
| 50 | Dropdown-меню (фильтры, bulk-toolbar) |
| 100 | Sidebar |
| 999 | Контекстное меню |
| 1000 | Модальное окно + overlay |

### 3.4 Кнопки (.btn)

**Базовый стиль:**
```css
padding: 12px 24px;
border-radius: 8px;
font-size: 14px;
font-weight: 500;
transition: all 0.2s ease;
```

**Варианты:**
- `.btn-primary` — зелёная (accent-primary), тёмный текст
- `.btn-secondary` — тёмно-серая (bg-tertiary), светлый текст, рамка border-color
- `.btn-danger` — красноватая (rgba(255, 51, 102, 0.15)), красный текст, рамка rgba(255, 51, 102, 0.3)
- `.btn-sm` — уменьшенный размер (padding: 8px 16px, font-size: 13px)

**Hover эффекты:**
- `.btn-primary:hover` — яркость увеличивается (#00ff99), добавляется тень-свечение (box-shadow: 0 0 20px var(--glow))
- `.btn-secondary:hover` — фон bg-secondary
- `.btn-danger:hover` — увеличение прозрачности фона до 0.25

---

## 4. Технические требования

### 4.1 HTML-структура

- **Sidebar:** Подключается как внешний компонент (`<aside class="sidebar"></aside>`)
- **Основной контент:** `.main-content` с отступом слева 72px (ширина sidebar)
- **Таблица:** Нативный `<table>` с семантической структурой (`<thead>`, `<tbody>`)

### 4.2 JavaScript

**Подключение:**
```html
<script src="../components/sidebar.js"></script>
<script>
    (function () {
        // Вся логика страницы в IIFE (изолированная область видимости)
    })();
</script>
```

**Ключевые функции:**

1. **Управление выбором строк:**
   - `updateToolbar()` — обновление видимости и счётчика bulk-toolbar
   - `getSelectedCount()` — подсчёт выбранных строк
   - Обработчики событий для `selectAll` и `.row-checkbox`

2. **Dropdown-меню:**
   - `closeAllDropdowns()` — закрытие всех bulk-dropdown
   - `closeAllFilterDropdowns()` — закрытие всех фильтр-dropdown
   - `updateFilterBtnText(btn, menu, allLabel)` — обновление текста кнопки фильтра
   - Обработчики для открытия/закрытия и применения изменений

3. **Контекстное меню:**
   - Обработчик события `contextmenu` на `tbody`
   - Автоматический выбор строки при ПКМ (если не выбрана)
   - Позиционирование по координатам курсора

4. **Модальное окно:**
   - Динамическое обновление текста с количеством удаляемых объектов
   - Удаление выбранных строк из DOM (mock-операция)
   - Сброс состояния выбора после удаления

5. **Глобальные обработчики:**
   - `document.addEventListener('click')` — закрытие всех открытых dropdown и меню при клике вне их

### 4.3 Анимации

**Fade-in для строк таблицы:**
```css
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

.objects-table tbody tr {
    animation: fadeIn 0.3s ease backwards;
}

.objects-table tbody tr:nth-child(1) { animation-delay: 0.03s; }
.objects-table tbody tr:nth-child(2) { animation-delay: 0.06s; }
/* и т.д. до 8-й строки */
```

**Slide-down для bulk-toolbar:**
```css
@keyframes slideDown {
    from { opacity: 0; transform: translateY(-8px); }
    to { opacity: 1; transform: translateY(0); }
}

.bulk-toolbar.visible {
    animation: slideDown 0.2s ease;
}
```

**Modal появление:**
```css
@keyframes modalIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}

.modal {
    animation: modalIn 0.2s ease;
}
```

---

## 5. Критерии приёмки (Definition of Done)

### Функциональность:
- ✅ Поиск по названию и URL работает с debounce 300ms
- ✅ Фильтры по группам и тегам применяются корректно
- ✅ Кнопка "Сбросить" очищает все фильтры
- ✅ Select All выделяет/снимает все строки, поддерживает indeterminate состояние
- ✅ Bulk-toolbar появляется при выборе ≥1 строки
- ✅ Dropdown в фильтрах и bulk-toolbar работают с взаимным закрытием
- ✅ Контекстное меню появляется по ПКМ, автоматически выделяет строку
- ✅ Модальное окно удаления показывает количество выбранных объектов
- ✅ После удаления строки исчезают, состояние сбрасывается
- ✅ Пагинация отображает корректную информацию

### Визуал и UX:
- ✅ Все цвета соответствуют CSS-переменным dark theme
- ✅ Анимации работают плавно (fadeIn, slideDown, modalIn)
- ✅ Выбранные строки подсвечиваются зелёным фоном
- ✅ Hover эффекты применяются ко всем интерактивным элементам
- ✅ URL обрезается ellipsis при переполнении 320px
- ✅ Теги имеют корректную цветовую кодировку
- ✅ Бейджи групп отображаются с голубым фоном и рамкой

### Техническая реализация:
- ✅ HTML валидный, семантический
- ✅ CSS использует переменные, без хардкода цветов
- ✅ JavaScript в IIFE, изолированная область видимости
- ✅ Sidebar подключается как внешний компонент
- ✅ Код читаемый, с комментариями для сложных блоков
- ✅ Нет ошибок в консоли браузера

### Кросс-браузерность:
- ✅ Chrome (последняя версия)
- ✅ Firefox (последняя версия)
- ✅ Safari (последняя версия)
- ✅ Edge (последняя версия)

### Производительность:
- ✅ Страница загружается менее 1 секунды
- ✅ Фильтрация работает без задержек (< 300ms)
- ✅ Анимации не вызывают jank (60 FPS)

---

## 6. Файлы и зависимости

**Основной файл:**
- `pages/objects.html`

**Зависимости:**
- `components/sidebar.css` — стили сайдбара
- `components/sidebar.js` — логика сайдбара

**Связанная документация:**
- `docs/103_objects-page.md` — подробная документация страницы
- `docs/101_object-set.md` — концепция объектов мониторинга

---

## 7. Примечания для разработчика

1. **Все dropdown-меню должны закрываться при клике вне их.** Используйте `event.stopPropagation()` для предотвращения закрытия при клике внутри dropdown.

2. **Контекстное меню должно автоматически выделять строку при ПКМ,** если она не была выбрана ранее. Это улучшает UX при работе с одиночными объектами.

3. **Модальное окно удаления должно динамически обновлять текст** с количеством выбранных объектов. Используйте `textContent` для безопасной вставки данных.

4. **Фильтры должны работать совместно** (AND-логика): если выбран фильтр по группе "Operators" и тег "HLS", показывать только объекты, имеющие И группу Operators, И тег HLS.

5. **Анимация fadeIn для строк таблицы** должна применяться только при первой загрузке. При фильтрации можно использовать более быструю анимацию или убрать её совсем.

6. **Z-index важны для корректной работы overlays.** Убедитесь, что модальное окно (z-index: 1000) всегда поверх контекстного меню (z-index: 999).

7. **Для мок-данных используйте реалистичные URL:** HLS-потоки с `.m3u8`, MPEG-TS с `udp://` протоколом.

---

## 8. Вопросы для уточнения (если есть)

- Нужно ли сохранять состояние фильтров в LocalStorage?
- Должна ли пагинация быть серверной или клиентской?
- Нужен ли экспорт в CSV/JSON или это заглушка для MVP?
- Должны ли массовые изменения (группы/теги) отправляться на сервер немедленно или батчами?

---

**Приоритет:** High
**Оценка:** 13 SP (Story Points)
**Метки:** frontend, ui, monitoring, tables

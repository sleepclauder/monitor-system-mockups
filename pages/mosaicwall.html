<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ĞœĞ¾Ğ·Ğ°Ğ¸ĞºĞ° â€” MoniX</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../components/sidebar.css">
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-tertiary: #1a2332;
            --accent-primary: #00ff88;
            --accent-secondary: #00ccff;
            --accent-warning: #ffaa00;
            --accent-danger: #ff3366;
            --text-primary: #e4e8f0;
            --text-secondary: #8b94a8;
            --border-color: #1f2937;
            --glow: rgba(0, 255, 136, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        .app-layout {
            display: flex;
            height: 100vh;
        }

        /* â”€â”€â”€ Channel Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .channel-panel {
            width: 260px;
            min-width: 260px;
            margin-left: 72px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: width 0.25s ease, min-width 0.25s ease;
            overflow: hidden;
            z-index: 10;
        }

        .channel-panel.collapsed {
            width: 0;
            min-width: 0;
            border-right: none;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .panel-header-title {
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .panel-toggle-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 4px;
            font-size: 12px;
            transition: color 0.2s, background 0.2s;
            flex-shrink: 0;
        }

        .panel-toggle-btn:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .panel-search {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .panel-search input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 13px;
            outline: none;
            white-space: nowrap;
        }

        .panel-search input::placeholder { color: var(--text-secondary); }
        .panel-search input:focus { border-color: var(--accent-primary); }

        .channel-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .channel-list::-webkit-scrollbar { width: 4px; }
        .channel-list::-webkit-scrollbar-track { background: transparent; }
        .channel-list::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 2px; }

        .channel-group-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding: 8px 8px 4px;
        }

        .channel-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 9px 10px;
            border-radius: 6px;
            cursor: grab;
            user-select: none;
            transition: background 0.15s;
            white-space: nowrap;
        }

        .channel-item:hover { background: var(--bg-tertiary); }
        .channel-item:active { cursor: grabbing; }
        .channel-item.dragging { opacity: 0.4; }

        .channel-status-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .channel-status-dot.online { background: var(--accent-primary); box-shadow: 0 0 6px var(--accent-primary); }
        .channel-status-dot.offline { background: var(--text-secondary); }
        .channel-status-dot.warning { background: var(--accent-warning); box-shadow: 0 0 6px var(--accent-warning); }

        .channel-icon {
            font-size: 15px;
            flex-shrink: 0;
        }

        .channel-name {
            font-size: 13px;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* â”€â”€â”€ Main Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 0;
        }

        /* â”€â”€â”€ Toolbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 52px;
            min-height: 52px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            gap: 12px;
            flex-shrink: 0;
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-open-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .panel-open-btn:hover {
            color: var(--text-primary);
            border-color: var(--accent-primary);
        }

        .page-title {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: -0.2px;
            white-space: nowrap;
        }

        .toolbar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 7px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
            white-space: nowrap;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        .btn-secondary:hover { background: #1f2d3f; border-color: #2a3a4f; }

        .btn-danger {
            background: rgba(255, 51, 102, 0.12);
            color: var(--accent-danger);
            border: 1px solid rgba(255, 51, 102, 0.25);
        }
        .btn-danger:hover { background: rgba(255, 51, 102, 0.22); }

        /* â”€â”€â”€ Bookmarks Dropdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .bookmarks-wrap {
            position: relative;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: calc(100% + 6px);
            right: 0;
            min-width: 220px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            z-index: 200;
            overflow: hidden;
        }

        .dropdown-menu.open { display: block; }

        .dropdown-section {
            padding: 6px;
            border-bottom: 1px solid var(--border-color);
        }

        .dropdown-section:last-child { border-bottom: none; }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 8px 10px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 13px;
            font-family: 'Outfit', sans-serif;
            cursor: pointer;
            border-radius: 6px;
            text-align: left;
            transition: background 0.15s;
        }

        .dropdown-item:hover { background: var(--bg-tertiary); }

        .dropdown-item.danger { color: var(--accent-danger); }
        .dropdown-item.danger:hover { background: rgba(255,51,102,0.1); }

        .dropdown-label {
            padding: 8px 12px 4px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--text-secondary);
        }

        .saved-layout-row {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
        }

        .saved-layout-row .dropdown-item {
            flex: 1;
            padding: 7px 8px;
        }

        .layout-delete-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 12px;
            transition: color 0.15s, background 0.15s;
            flex-shrink: 0;
        }

        .layout-delete-btn:hover { color: var(--accent-danger); background: rgba(255,51,102,0.1); }

        .dropdown-empty {
            padding: 10px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }

        /* â”€â”€â”€ Player Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .player-area {
            flex: 1;
            overflow: auto;
            position: relative;
            padding: 16px;
        }

        .player-area.drag-over {
            background: rgba(0, 255, 136, 0.03);
        }

        .player-area::-webkit-scrollbar { width: 6px; height: 6px; }
        .player-area::-webkit-scrollbar-track { background: transparent; }
        .player-area::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }

        .player-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 12px;
            align-content: start;
        }

        /* â”€â”€â”€ Drop Hint â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .drop-hint {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.04);
            border: 1px dashed rgba(255,255,255,0.12);
            border-radius: 24px;
            color: var(--text-secondary);
            font-size: 13px;
            pointer-events: none;
            transition: opacity 0.3s;
            white-space: nowrap;
        }

        .drop-hint.hidden { opacity: 0; }

        .hint-icon {
            font-size: 18px;
            opacity: 0.5;
        }

        /* â”€â”€â”€ Player Cell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .player-cell {
            position: relative;
            aspect-ratio: 16 / 9;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            background: #050810;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .player-cell:hover {
            border-color: rgba(0, 255, 136, 0.3);
            box-shadow: 0 0 16px rgba(0, 255, 136, 0.08);
        }

        .player-cell:hover .player-controls { opacity: 1; }

        /* Simulated video feed */
        .player-video {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .player-video::after {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.08) 2px,
                rgba(0,0,0,0.08) 4px
            );
            pointer-events: none;
        }

        .player-noise {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* â”€â”€â”€ Player Info Overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .player-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px 12px 10px;
            background: linear-gradient(transparent, rgba(0,0,0,0.75));
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
        }

        .player-channel-name {
            font-size: 12px;
            font-weight: 600;
            color: #fff;
            text-shadow: 0 1px 4px rgba(0,0,0,0.8);
        }

        .player-live-badge {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.05em;
            padding: 2px 6px;
            border-radius: 3px;
            background: var(--accent-danger);
            color: #fff;
        }

        .player-live-badge.offline {
            background: var(--text-secondary);
        }

        /* â”€â”€â”€ Player Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .player-controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .player-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.15s;
        }

        .player-btn-close {
            background: rgba(255, 51, 102, 0.75);
            color: #fff;
        }
        .player-btn-close:hover { background: var(--accent-danger); }

        .player-btn-fs {
            background: rgba(0,0,0,0.6);
            color: rgba(255,255,255,0.8);
        }
        .player-btn-fs:hover { background: rgba(0,0,0,0.85); color: #fff; }

        /* â”€â”€â”€ Fullscreen Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .fs-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 1000;
            flex-direction: column;
        }
        .fs-overlay.open { display: flex; }

        .fs-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: rgba(0,0,0,0.8);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1;
        }

        .fs-channel-name {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }

        .fs-close-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-family: 'Outfit', sans-serif;
        }
        .fs-close-btn:hover { background: rgba(255,255,255,0.2); }

        .fs-video {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fs-video-inner {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
<div class="app-layout">
    <aside class="sidebar"></aside>

    <!-- â”€â”€â”€ Channel Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="channel-panel" id="channelPanel">
        <div class="panel-header">
            <span class="panel-header-title">ĞšĞ°Ğ½Ğ°Ğ»Ñ‹</span>
            <button class="panel-toggle-btn" id="panelCollapseBtn" title="Ğ¡Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ">â—€</button>
        </div>
        <div class="panel-search">
            <input type="text" id="channelSearch" placeholder="ĞŸĞ¾Ğ¸ÑĞºâ€¦">
        </div>
        <div class="channel-list" id="channelList"></div>
    </div>

    <!-- â”€â”€â”€ Main Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="main-area">
        <div class="toolbar">
            <div class="toolbar-left">
                <button class="panel-open-btn" id="panelOpenBtn" style="display:none">â–¶ ĞšĞ°Ğ½Ğ°Ğ»Ñ‹</button>
                <span class="page-title">ĞœĞ¾Ğ·Ğ°Ğ¸ĞºĞ°</span>
            </div>
            <div class="toolbar-right">
                <div class="bookmarks-wrap" id="bookmarksWrap">
                    <button class="btn btn-secondary" id="bookmarksBtn">ğŸ”– Ğ—Ğ°ĞºĞ»Ğ°Ğ´ĞºĞ¸ â–¾</button>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <div class="dropdown-section">
                            <button class="dropdown-item" id="saveLayoutBtn">ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ĞºÑƒ</button>
                        </div>
                        <div id="savedLayoutsSection">
                            <div class="dropdown-label">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ</div>
                            <div id="savedLayoutsList">
                                <div class="dropdown-empty">ĞĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ñ… Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ¾Ğº</div>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-danger" id="clearAllBtn">âœ• ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑÑ‘</button>
            </div>
        </div>

        <div class="player-area" id="playerArea">
            <div class="player-grid" id="playerGrid"></div>
            <div class="drop-hint" id="dropHint">
                <span class="hint-icon">âŠ</span>
                <span>ĞŸĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ ĞºĞ°Ğ½Ğ°Ğ» Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°</span>
            </div>
        </div>
    </div>
</div>

<!-- â”€â”€â”€ Fullscreen Overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="fs-overlay" id="fsOverlay">
    <div class="fs-toolbar">
        <span class="fs-channel-name" id="fsChannelName"></span>
        <button class="fs-close-btn" id="fsCloseBtn">âœ• Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
    </div>
    <div class="fs-video" id="fsVideo"></div>
</div>

<script src="../components/sidebar.js"></script>
<script>
// â”€â”€â”€ Channel Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CHANNELS = [
    { id: 1,  group: 'Ğ¡ĞºĞ»Ğ°Ğ´ Ğ',      name: 'Ğ’Ñ…Ğ¾Ğ´ â€” Ğ¡ĞºĞ»Ğ°Ğ´ Ğ',       status: 'online',  color: '#00ff88' },
    { id: 2,  group: 'Ğ¡ĞºĞ»Ğ°Ğ´ Ğ',      name: 'Ğ—Ğ¾Ğ½Ğ° Ğ¿Ğ¾Ğ³Ñ€ÑƒĞ·ĞºĞ¸',        status: 'online',  color: '#00ccff' },
    { id: 3,  group: 'Ğ¡ĞºĞ»Ğ°Ğ´ Ğ',      name: 'ĞŸĞµÑ€Ğ¸Ğ¼ĞµÑ‚Ñ€ Ğ¡ĞµĞ²ĞµÑ€',       status: 'warning', color: '#ffaa00' },
    { id: 4,  group: 'Ğ¡ĞºĞ»Ğ°Ğ´ Ğ',      name: 'ĞŸĞµÑ€Ğ¸Ğ¼ĞµÑ‚Ñ€ Ğ®Ğ³',          status: 'offline', color: '#8b94a8' },
    { id: 5,  group: 'ĞÑ„Ğ¸ÑĞ½Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº', name: 'Ğ ĞµÑĞµĞ¿ÑˆĞ½',              status: 'online',  color: '#a78bfa' },
    { id: 6,  group: 'ĞÑ„Ğ¸ÑĞ½Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº', name: 'ĞšĞ¾Ñ€Ğ¸Ğ´Ğ¾Ñ€ 1-Ğ¹ ÑÑ‚Ğ°Ğ¶',     status: 'online',  color: '#fb923c' },
    { id: 7,  group: 'ĞÑ„Ğ¸ÑĞ½Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº', name: 'ĞšĞ¾Ñ€Ğ¸Ğ´Ğ¾Ñ€ 2-Ğ¹ ÑÑ‚Ğ°Ğ¶',     status: 'online',  color: '#f472b6' },
    { id: 8,  group: 'ĞÑ„Ğ¸ÑĞ½Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº', name: 'Ğ¡ĞµÑ€Ğ²ĞµÑ€Ğ½Ğ°Ñ',            status: 'online',  color: '#34d399' },
    { id: 9,  group: 'ĞŸĞ°Ñ€ĞºĞ¾Ğ²ĞºĞ°',     name: 'Ğ’ÑŠĞµĞ·Ğ´ Ğ',              status: 'online',  color: '#60a5fa' },
    { id: 10, group: 'ĞŸĞ°Ñ€ĞºĞ¾Ğ²ĞºĞ°',     name: 'Ğ’ÑŠĞµĞ·Ğ´ Ğ‘',              status: 'online',  color: '#fbbf24' },
    { id: 11, group: 'ĞŸĞ°Ñ€ĞºĞ¾Ğ²ĞºĞ°',     name: 'Ğ¡ĞµĞºÑ‚Ğ¾Ñ€ 1-3',           status: 'warning', color: '#ffaa00' },
    { id: 12, group: 'ĞŸĞ°Ñ€ĞºĞ¾Ğ²ĞºĞ°',     name: 'Ğ¡ĞµĞºÑ‚Ğ¾Ñ€ 4-6',           status: 'offline', color: '#8b94a8' },
];

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let players = [];       // [{id, channel}]
let nextPlayerId = 1;
let panelOpen = true;
let dragChannelId = null;

// â”€â”€â”€ Render Channel List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderChannelList(filter = '') {
    const list = document.getElementById('channelList');
    const groups = {};
    CHANNELS.forEach(ch => {
        if (filter && !ch.name.toLowerCase().includes(filter.toLowerCase())) return;
        if (!groups[ch.group]) groups[ch.group] = [];
        groups[ch.group].push(ch);
    });

    list.innerHTML = '';
    Object.entries(groups).forEach(([group, channels]) => {
        const lbl = document.createElement('div');
        lbl.className = 'channel-group-label';
        lbl.textContent = group;
        list.appendChild(lbl);

        channels.forEach(ch => {
            const item = document.createElement('div');
            item.className = 'channel-item';
            item.draggable = true;
            item.dataset.channelId = ch.id;
            item.innerHTML = `
                <span class="channel-status-dot ${ch.status}"></span>
                <span class="channel-icon">ğŸ“·</span>
                <span class="channel-name">${ch.name}</span>
            `;
            item.addEventListener('dragstart', e => {
                dragChannelId = ch.id;
                item.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'copy';
            });
            item.addEventListener('dragend', () => {
                item.classList.remove('dragging');
                dragChannelId = null;
            });
            list.appendChild(item);
        });
    });

    if (!list.childElementCount) {
        list.innerHTML = '<div style="padding:16px;font-size:13px;color:var(--text-secondary);text-align:center">ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾</div>';
    }
}

// â”€â”€â”€ Player Cell Builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPlayerCell(playerId, channel) {
    const cell = document.createElement('div');
    cell.className = 'player-cell';
    cell.dataset.playerId = playerId;

    // Simulated video gradient per channel color
    const bg = `radial-gradient(ellipse at 30% 40%, ${channel.color}18 0%, transparent 60%),
                radial-gradient(ellipse at 70% 70%, ${channel.color}10 0%, transparent 50%),
                #050810`;

    const isLive = channel.status === 'online';
    const isWarn = channel.status === 'warning';

    cell.innerHTML = `
        <div class="player-video">
            <div class="player-noise" style="background: ${bg}">
                <span style="font-size:32px;opacity:0.15">ğŸ“·</span>
            </div>
        </div>
        <div class="player-info">
            <span class="player-channel-name">${channel.name}</span>
            <span class="player-live-badge ${isLive || isWarn ? '' : 'offline'}">
                ${isLive ? 'LIVE' : isWarn ? 'WARN' : 'OFF'}
            </span>
        </div>
        <div class="player-controls">
            <button class="player-btn player-btn-fs" title="ĞĞ° Ğ²ĞµÑÑŒ ÑĞºÑ€Ğ°Ğ½">â›¶</button>
            <button class="player-btn player-btn-close" title="Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ">âœ•</button>
        </div>
    `;

    cell.querySelector('.player-btn-close').addEventListener('click', () => removePlayer(playerId));
    cell.querySelector('.player-btn-fs').addEventListener('click', () => openFullscreen(channel));

    return cell;
}

// â”€â”€â”€ Add / Remove Players â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addPlayer(channelId) {
    const channel = CHANNELS.find(c => c.id === channelId);
    if (!channel) return;

    const playerId = nextPlayerId++;
    players.push({ id: playerId, channelId });

    const grid = document.getElementById('playerGrid');
    grid.appendChild(buildPlayerCell(playerId, channel));
    updateHint();
}

function removePlayer(playerId) {
    players = players.filter(p => p.id !== playerId);
    const cell = document.querySelector(`[data-player-id="${playerId}"]`);
    if (cell) cell.remove();
    updateHint();
}

function clearAll() {
    players = [];
    document.getElementById('playerGrid').innerHTML = '';
    updateHint();
}

function updateHint() {
    const hint = document.getElementById('dropHint');
    if (players.length > 0) {
        hint.classList.add('hidden');
    } else {
        hint.classList.remove('hidden');
    }
}

// â”€â”€â”€ Drop Zone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const playerArea = document.getElementById('playerArea');

playerArea.addEventListener('dragover', e => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'copy';
    playerArea.classList.add('drag-over');
});

playerArea.addEventListener('dragleave', e => {
    if (!playerArea.contains(e.relatedTarget)) {
        playerArea.classList.remove('drag-over');
    }
});

playerArea.addEventListener('drop', e => {
    e.preventDefault();
    playerArea.classList.remove('drag-over');
    if (dragChannelId !== null) {
        addPlayer(dragChannelId);
    }
});

// â”€â”€â”€ Fullscreen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openFullscreen(channel) {
    const overlay = document.getElementById('fsOverlay');
    const fsVideo = document.getElementById('fsVideo');
    document.getElementById('fsChannelName').textContent = channel.name;

    const bg = `radial-gradient(ellipse at 30% 40%, ${channel.color}18 0%, transparent 60%),
                radial-gradient(ellipse at 70% 70%, ${channel.color}12 0%, transparent 50%),
                #050810`;

    fsVideo.innerHTML = `
        <div class="fs-video-inner" style="background:${bg};width:100%;height:100%;justify-content:center;align-items:center;display:flex">
            <span style="font-size:64px;opacity:0.1">ğŸ“·</span>
        </div>
    `;
    overlay.classList.add('open');
}

document.getElementById('fsCloseBtn').addEventListener('click', () => {
    document.getElementById('fsOverlay').classList.remove('open');
});

document.addEventListener('keydown', e => {
    if (e.key === 'Escape') document.getElementById('fsOverlay').classList.remove('open');
});

// â”€â”€â”€ Panel Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('panelCollapseBtn').addEventListener('click', () => {
    panelOpen = false;
    document.getElementById('channelPanel').classList.add('collapsed');
    document.getElementById('panelOpenBtn').style.display = '';
});

document.getElementById('panelOpenBtn').addEventListener('click', () => {
    panelOpen = true;
    document.getElementById('channelPanel').classList.remove('collapsed');
    document.getElementById('panelOpenBtn').style.display = 'none';
});

// â”€â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('channelSearch').addEventListener('input', e => {
    renderChannelList(e.target.value);
});

// â”€â”€â”€ Bookmarks Dropdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const bookmarksBtn = document.getElementById('bookmarksBtn');
const dropdownMenu = document.getElementById('dropdownMenu');

bookmarksBtn.addEventListener('click', e => {
    e.stopPropagation();
    dropdownMenu.classList.toggle('open');
    if (dropdownMenu.classList.contains('open')) renderSavedLayouts();
});

document.addEventListener('click', () => dropdownMenu.classList.remove('open'));
dropdownMenu.addEventListener('click', e => e.stopPropagation());

document.getElementById('saveLayoutBtn').addEventListener('click', () => {
    if (players.length === 0) {
        alert('ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»ĞµĞµÑ€Ğ¾Ğ² Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ.');
        return;
    }
    const name = prompt('ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ĞºĞ¸:', `Ğ Ğ°ÑĞºĞ»Ğ°Ğ´ĞºĞ° ${new Date().toLocaleTimeString('ru', {hour:'2-digit',minute:'2-digit'})}`);
    if (!name) return;

    const layouts = loadLayouts();
    layouts.push({ name, channels: players.map(p => p.channelId), ts: Date.now() });
    saveLayouts(layouts);
    renderSavedLayouts();
    dropdownMenu.classList.remove('open');
});

document.getElementById('clearAllBtn').addEventListener('click', clearAll);

function loadLayouts() {
    try { return JSON.parse(localStorage.getItem('monix_layouts') || '[]'); } catch { return []; }
}

function saveLayouts(layouts) {
    localStorage.setItem('monix_layouts', JSON.stringify(layouts));
}

function renderSavedLayouts() {
    const layouts = loadLayouts();
    const container = document.getElementById('savedLayoutsList');
    if (!layouts.length) {
        container.innerHTML = '<div class="dropdown-empty">ĞĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ñ… Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ¾Ğº</div>';
        return;
    }
    container.innerHTML = '';
    layouts.forEach((layout, idx) => {
        const row = document.createElement('div');
        row.className = 'saved-layout-row';
        row.innerHTML = `
            <button class="dropdown-item">ğŸ“ ${layout.name} <span style="color:var(--text-secondary);font-size:11px;margin-left:auto">${layout.channels.length} ĞºĞ°Ğ¼.</span></button>
            <button class="layout-delete-btn" title="Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ">ğŸ—‘</button>
        `;
        row.querySelector('.dropdown-item').addEventListener('click', () => {
            clearAll();
            layout.channels.forEach(chId => addPlayer(chId));
            dropdownMenu.classList.remove('open');
        });
        row.querySelector('.layout-delete-btn').addEventListener('click', () => {
            const layouts = loadLayouts();
            layouts.splice(idx, 1);
            saveLayouts(layouts);
            renderSavedLayouts();
        });
        container.appendChild(row);
    });
}

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderChannelList();
updateHint();
</script>
</body>
</html>
